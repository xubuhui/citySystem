<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>城市后台管理系统</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/xadmin.css">
    <!--<link rel="stylesheet" href="https://cdn.bootcss.com/Swiper/3.4.2/css/swiper.min.css">-->
    <!--<script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>-->
    <!--<script type="text/javascript" src="https://cdn.bootcss.com/Swiper/3.4.2/js/swiper.jquery.min.js"></script>-->
    <link rel="stylesheet" href="https://unpkg.com/swiper/css/swiper.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper/css/swiper.min.css">
    <script type="text/javascript" src="./js/jquery-3.1.1.min.js"></script>
    <script src="https://unpkg.com/swiper/js/swiper.js"> </script>
    <script src="https://unpkg.com/swiper/js/swiper.min.js"> </script>

    <script src="./lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/xadmin.js"></script>
    <script type="text/javascript" src="./js/jquery.cookie.js"></script>
    <link rel="stylesheet" href="./js/jquery.pagination.css"/>
    <script src="./js/jquery.pagination.min.js"></script>
</head>
<body>
    <!-- 顶部开始 -->
    <div class="container">
        <div class="logo"><a>城市后台管理系统</a></div>
        <div class="open-nav"><i class="iconfont">&#xe699;</i></div>
        <ul class="layui-nav right" lay-filter="">
          <li class="layui-nav-item">
            <a href="javascript:;">管理员</a>
            </dl>
          </li>
        </ul>
    </div>
    <!-- 顶部结束 -->
    <!-- 中部开始 -->
    <div class="wrapper">
        <!-- 左侧菜单开始 -->
        <div class="left-nav">
            <div id="side-nav">
                <ul id="nav">
                    <li class="list" current>
                        <a href="./member-list.html">
                            <i class="iconfont">&#xe761;</i>
                            小区信息
                            <i class="iconfont nav_right">&#xe697;</i>
                        </a>
                    </li>
                    <li class="list">
                        <a href="./user-list.html">
                            <i class="iconfont">&#xe70b;</i>
                            用户信息
                            <i class="iconfont nav_right">&#xe697;</i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- 左侧菜单结束 -->
        <!-- 右侧主体开始 -->
        <div class="page-content">
          <div class="content">
            <!-- 右侧内容框架，更改从这里开始 -->
            <form class="layui-form xbs" action="" >
                <div class="layui-form-pane" style="text-align: center;">
                  <div class="layui-form-item" style="display: inline-block;">
                    <label class="layui-form-label xbs768">搜索</label>
                    <div class="layui-input-inline">
                      <input type="text" name="nick_name"  placeholder="请输入小区名" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-input-inline" style="width:80px">
                        <button class="layui-btn"  lay-submit="" lay-filter="sreach" onclick="$.cookie('page2',1);"><i class="layui-icon">&#xe615;</i></button>
                    </div>
                      <div class="layui-input-inline" style="width:80px">
                          <button class="layui-btn" onclick=" $.cookie('page2',1);location.href='user-list.html'" type="button"><i
                                  class="layui-icon">&#x1002;</i></button>
                      </div>
                  </div>
                </div> 
            </form>
              <span class="x-right" style="line-height:40px">共有数据：<span id="num"></span> 条</span>
            <table class="layui-table">
                <thead>
                <tr>
                    <th>
                        ID
                    </th>
                    <th>
                        省
                    </th>
                    <th>
                        市
                    </th>
                    <th>
                        区
                    </th>
                    <th>
                        小区名
                    </th>
                    <th>
                        经度
                    </th>
                    <th>
                        纬度
                    </th>
                    <th>
                        单价
                    </th>
                    <th>
                        操作
                    </th>
                </tr>
                </thead>
                <tbody ></tbody>
            </table>
              <!--<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">-->
                  <legend>
                      <div id="page"></div>
                  </legend>
              <!--</fieldset>-->
            <!-- 右侧内容框架，更改从这里结束 -->
          </div>
        </div>
        <!-- 右侧主体结束 -->
    </div>
    <!-- 中部结束 -->
    <!-- 底部开始 -->
    <div class="footer">
    </div>
    <!-- 底部结束 -->
    <!-- 背景切换开始 -->
    <div class="bg-changer">
        <div class="swiper-container changer-list">
            <div class="swiper-wrapper">
                <div class="swiper-slide"><img class="item" src="./images/a.jpg" alt=""></div>
                <div class="swiper-slide"><img class="item" src="./images/b.jpg" alt=""></div>
                <div class="swiper-slide"><img class="item" src="./images/c.jpg" alt=""></div>
                <div class="swiper-slide"><img class="item" src="./images/d.jpg" alt=""></div>
                <div class="swiper-slide"><img class="item" src="./images/e.jpg" alt=""></div>
                <div class="swiper-slide"><img class="item" src="./images/f.jpg" alt=""></div>
                <div class="swiper-slide"><img class="item" src="./images/g.jpg" alt=""></div>
                <div class="swiper-slide"><img class="item" src="./images/h.jpg" alt=""></div>
                <div class="swiper-slide"><img class="item" src="./images/i.jpg" alt=""></div>
                <div class="swiper-slide"><img class="item" src="./images/j.jpg" alt=""></div>
                <div class="swiper-slide"><img class="item" src="./images/k.jpg" alt=""></div>
                <div class="swiper-slide"><span class="reset">初始化</span></div>
            </div>
        </div>
        <div class="bg-out"></div>
        <div id="changer-set"><i class="iconfont">&#xe696;</i></div>   
    </div>
    <!-- 背景切换结束 -->
    <!-- 页面动态效果 -->
    <script>
        let url;
        $(function () {
            $.cookie('page1',1);
            let cookie = $.cookie('admin');
            if (cookie == null || cookie === '') {
                location.href = 'login.html';
                return false;
            }
            showReocrd(0, 10);
            // alert($.cookie('allNum2'));

        });

        function showReocrd(pageNo, pageSize) {
            $('tbody').empty();
            $('#num').empty();
            let nick_name = getQueryString('nick_name');
            if (nick_name != null && nick_name != '') {
                url = "app/userAction.php?action=userWhile&nick_name=" + nick_name;
                $("#nick_name").attr('placeholder',nick_name);
            } else {
                url = "app/userAction.php?action=userList";
            }
            $.ajax({
                type: "get",
                async: true,            //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
                url: url,
                data:{'pageNo':pageNo,'pageSize':pageSize},
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    $("#num").append(data[0]);
                    // $.cookie('allNum2',Math.ceil(data[0]/10));
                    let allPage = Math.ceil(data[0]/10);
                    console.log(allPage);
                    $("#page").pagination({
                        currentPage:  　parseInt( $.cookie('page2'))===0?1:parseInt( $.cookie('page2')),// 当前页数
                        totalPage: allPage,// 总页数
                        isShow: true,// 是否显示首尾页
                        count: allPage<=5? allPage:5,// 显示个数
                        homePageText: "首页",
                        endPageText: "尾页",
                        prevPageText: "上一页",
                        nextPageText: "下一页",
                        callback: function (current) {
                            $.cookie('page2',current);
                            showReocrd(((current-1)*10), 10);
                        }
                    });


                    $.each(data[1], function (index, item) {
                            var td = $("<td></td>").text(item.id);
                            var td2 = $("<td></td>").text(item.province);
                            var td3 = $("<td></td>").text(item.city);
                            var td4 = $("<td></td>").text(item.district);
                            var td5 = $("<td></td>").text(item.nick_name);
                            var td6 = $("<td></td>").text(item.lng);
                            var td7 = $("<td></td>").text(item.lat);
                            var td8 = $("<td></td>").text(item.price);
                            var td9 = $("<td>  <a title=\"编辑\" href=\"javascript:;\" onclick=\"member_edit('编辑','user-edit.html?id=" + item.id + "'," + item.id + ",'','510')\"\n" +
                                "                            class=\"ml-5\" style=\"text-decoration:none\">\n" +
                                "  <i class=\"layui-icon\">&#xe642;</i>\n" +
                                " </a>" +
                                " <a style=\"text-decoration:none\" title=\"审核\" onclick=\"user_about('审核页面','user-about.html?id=" + item.id + "'," + item.id + ",'','410')\" >\n" +
                                "                                <i class=\"layui-icon\">&#xe605;</i>\n" +
                                "                            </a>" +
                                "  <a title=\"删除\" href=\"javascript:;\" onclick=\"member_del(this," + item.id + ")\"\n" +
                                "                            style=\"text-decoration:none\">\n" +
                                "                                <i class=\"layui-icon\">&#xe640;</i>\n" +
                                "                            </a></td>");
                            var tr = $("<tr></tr>").append(td, td2, td3, td4, td5, td6, td7, td8, td9);
                            $('tbody').append(tr);
                        }
                    );
                }
            });
        }


        //编辑
        function member_edit(title, url, id, w, h) {
            x_admin_show(title, url, w, h);
        }

        function user_about(title, url, id, w, h) {
            x_admin_show(title, url, w, h);
        }
        function getQueryString(key){
            var reg = new RegExp("(^|&)"+key+"=([^&]*)(&|$)");
            var result = window.location.search.substr(1).match(reg);
            return result?decodeURIComponent(result[2]):null;
        }

        /*删除*/
        function member_del(obj, id) {
            layer.confirm('确认要删除吗？', function (index) {
                //发异步删除数据
                $.get("app/userAction.php?action=userDel", {
                    id: id,
                }, function (data) {
                    console.log(data);
                });

                $(obj).parents("tr").remove();
                layer.msg('已删除!', {icon: 1, time: 1000});
            });
        }
        </script>
</body>
</html>